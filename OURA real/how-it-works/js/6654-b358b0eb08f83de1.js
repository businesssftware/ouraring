"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6654],{1608:(e,t,r)=>{r.d(t,{LEGACY_ENV_KEY:()=>a,default:()=>u});var n=r(87397),o=r(57509);let a="__DO_NOT_USE__ENV",u=e=>{let{children:t}=e,r=(0,n.useEnvContext)();return(0,o.A)()&&(window[a]=r),t}},1728:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(57509),o=r(75284),a=r(34477);let u=(0,a.createServerReference)("7fdb00b95c60647f06b2b9230388243b77c540600b",a.callServer,void 0,a.findSourceMapURL,"default"),i=e=>{let{data:t={},error:r,level:a="info",message:i,module:l}=e;((0,n.A)()?o.default:u)({data:t,error:r,level:r?"error":a,message:i,module:l})}},5221:(e,t,r)=>{r.d(t,{default:()=>v,S:()=>f});var n=r(95155),o=r(42626),a=r(12115),u=r(31274),i=r(95838),l=r(28151),s=r(84477);function d(){let e=(0,u._)(["\n  query Countries($countryCode: String) {\n    content {\n      countries(countryCode: $countryCode) {\n        currency\n        currencyForSubscription\n        supportedCurrencies\n        status\n        membershipStatus\n        countryCode\n        shippingRate {\n          description\n          price\n        }\n        eu\n        name\n        regions {\n          label\n          value\n          labelMsgKey\n        }\n        merchant {\n          prod\n          staging\n        }\n        disallowedProductSkus\n        labelMsgKey\n        enableForRma\n        showNoAdditionalTaxesMessage\n      }\n    }\n  }\n"]);return d=function(){return e},e}let c=(0,l.J1)(d());function y(e){return(0,i.useQuery)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{queryKey:["Countries",{vars:e}],queryFn:async()=>{var t,r;let n=new Map,o=null!=(r=null==(t=(await (0,s.A)(c,e)).content)?void 0:t.countries)?r:[];for(let e of o)(null==e?void 0:e.countryCode)&&n.set(e.countryCode,e);return{countries:o,byCountryCode:n}}}}({countryCode:e}))}let g=(0,a.createContext)(null),f=()=>{let e=(0,a.useContext)(g);if(!e)throw Error("Did you forget to include GeoProvider in your tree?");return e},v=e=>{let{children:t,countryCode:r}=e,a=(0,o.Ym)(),{data:u,isSuccess:i}=y(r),{data:l,isSuccess:s}=y("US"),d=null==u?void 0:u.countries,c=null==l?void 0:l.countries,f=i&&d?d[0]:s&&c?c[0]:{countryCode:"US",currency:"USD",eu:!1};return(0,n.jsx)(g.Provider,{value:{countryData:f,locale:a},children:t})}},5383:(e,t,r)=>{r.d(t,{RW:()=>o,Xx:()=>a});var n=r(57509);let o=(e,t)=>{if((0,n.A)())try{window.localStorage.setItem(e,t)}catch(e){}},a=e=>{if((0,n.A)())try{return window.localStorage.getItem(e)}catch(e){}return null}},19997:(e,t,r)=>{r.d(t,{NP:()=>u,Ri:()=>a,TV:()=>o});var n=r(57509);function o(e,t,r){if((0,n.A)()){let n="",o=new Date,a=new Date;o.setTime(a.getTime()+60*r*1e3),n="; expires="+o.toUTCString(),document.cookie=e+"="+(t||"")+n+"; path=/";return}return null}function a(e){if((0,n.A)()){let t=e+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let n=r[e];for(;n.startsWith(" ");)n=n.substring(1,n.length);if(n.startsWith(t))return n.substring(t.length,n.length)}}return null}function u(e){(0,n.A)()&&(document.cookie=e+"=; path=/; Max-Age=-99999999;")}},27177:(e,t,r)=>{r.d(t,{JL:()=>o,U2:()=>n});let n="cartId",o="ajs_anonymous_id"},41208:(e,t,r)=>{r.d(t,{z:()=>u});var n=r(57509),o=r(1608),a=r(87358);let u=e=>{if(a.env[e])return a.env[e];if((0,n.A)()){var t;return(null!=(t=window[o.LEGACY_ENV_KEY])?t:{})[e]}}},57480:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(5221);let o={AUD:"$",CAD:"$",GBP:"\xa3",EUR:"â‚¬",JPY:"\xa5",USD:"$"};function a(){let{countryData:e}=(0,n.S)(),t=null==e?void 0:e.currency,r=o[t];return{countryData:e,currencyCode:t,currencySymbol:r}}},57509:(e,t,r)=>{r.d(t,{A:()=>n});let n=()=>!0},65363:(e,t,r)=>{let n;r.d(t,{SX:()=>c});var o=r(81451),a=r(95844),u=r(55513),i=r(1728),l=r(57509);let s=e=>(0,o.XS)(e)||"pending"===e.state.status,d=()=>new a.E({defaultOptions:{queries:{staleTime:3e5},dehydrate:{shouldDehydrateQuery:s}},queryCache:new u.$({onError:(e,t)=>{(0,i.A)({data:{query:t},error:e,message:"Error fetching data with react-query:",module:"app"})}})}),c=()=>(0,l.A)()?(n||(n=d()),n):d()},68174:(e,t,r)=>{r.d(t,{Mg:()=>l,R2:()=>i,S$:()=>u});var n=r(65363),o=r(27177),a=r(19997);function u(){return(0,a.Ri)(o.U2)}function i(e){e?(0,a.TV)(o.U2,e,4320):(0,a.NP)(o.U2)}function l(){let e=(0,n.SX)();e.invalidateQueries({queryKey:["refreshCart"]}),e.invalidateQueries({queryKey:["useProductsData"]}),e.invalidateQueries({queryKey:["Calculate"]}),e.invalidateQueries({queryKey:["PDPData"]})}},75284:(e,t,r)=>{let n;r.d(t,{default:()=>d});var o=r(57975),a=r(55746),u=r(96363),i=r(24162),l=r(41208);let s="ecom-website",d=e=>{let t,{data:r={},error:d,level:c="info",message:y,module:g}=e;return"development"===(0,l.z)("NEXT_PUBLIC_OURA_ENV")?t=new u.oG({errorSerializer:i.P5,transport:new u.b6({level:c,logger:console})}):(n||(n=(()=>{let e=(0,l.z)("NEXT_PUBLIC_DD_CLIENT_TOKEN"),t=(0,l.z)("NEXT_PUBLIC_OURA_ENV");if(!e)throw Error("No Datadog client token set, please add the NEXT_PUBLIC_DD_CLIENT_TOKEN environment variable.");return o.yf.init({clientToken:e,env:t,forwardErrorsToLogs:!1,service:s,sessionSampleRate:100,site:"datadoghq.com"}),o.yf.addLoggerGlobalContext("env",t),o.yf.createLogger(s)})()),t=new u.oG({errorSerializer:i.P5,transport:new a.R({logger:n})})),t.withError(d).withMetadata({...r,module:g})[c](y)}},76702:(e,t,r)=>{r.d(t,{LE:()=>d,MM:()=>c,N$:()=>a,R7:()=>o,YU:()=>n,e4:()=>i,fG:()=>u,lh:()=>l,xz:()=>s});let n="pdp_discount_applied",o="sitewide_highest_discount_eyebrow_copy",a="expired",u="no_uses_remaining",i="discount_not_found",l="pdp_discount_error_used",s="pdp_discount_error_expired",d="pdp_discount_error",c="promotion_code"},84477:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(28151),o=r(41208);r(69233);var a=r(19997);let u=async(e,t,r)=>{var u,i;let l=(()=>{let e=(0,o.z)("NEXT_PUBLIC_ECOM_API_ENDPOINT");return e?"".concat(e,"/graphql"):void 0})(),s={"x-statsig-stable-id":null!=(u=(0,a.Ri)("statsigStableId"))?u:"","x-country":null!=(i=(0,a.Ri)("countryCode"))?i:"",...r};return(0,n.Em)(l,e,t,s)}},99599:(e,t,r)=>{r.d(t,{default:()=>x,B:()=>R});var n=r(95155),o=r(46391),a=r(31431),u=r.n(a),i=r(12115),l=r(1728),s=r(31274),d=r(95838),c=r(28151),y=r(84477);function g(){let e=(0,s._)(['\n  query GetCartSettings {\n    content {\n      cartSettings: getSettings(settingName: "cart") {\n        contentsJson\n      }\n    }\n  }\n']);return g=function(){return e},e}let f=(0,c.J1)(g());var v=r(68174),C=r(57509);function m(){let e=(0,s._)(["\n  query RefreshCart($cartId: String) {\n    cart(cartId: $cartId) {\n      refreshCart {\n        resultCategory\n        cartId\n        cartIdChangeReason\n        cart {\n          lastUpdatedAt\n          promotions {\n            promotionCode\n            campaign\n          }\n          lineItems {\n            skuCode\n            quantity\n            sku {\n              bbySkuId\n            }\n          }\n          isWarrantyReplacement\n          itemCountForIcon\n          maxRingQuantity\n          maxChargerQuantity\n          ringCount\n          chargerCount\n          digitalSized\n          creationTags {\n            vendorId\n          }\n        }\n      }\n    }\n  }\n"]);return m=function(){return e},e}let S=(0,c.J1)(m());var p=r(65363);function h(){let e=(0,s._)(["\n  query SavePromotion($cartId: String, $promotionCode: String!) {\n    cart(cartId: $cartId) {\n      savePromotion(promotionCode: $promotionCode) {\n        cartId\n        resultCategory\n        errorCode\n        invalidReason\n      }\n    }\n  }\n"]);return h=function(){return e},e}let _=(0,c.J1)(h());function E(e){return{queryKey:["savePromotion",e.cartId,e.promotionCode],queryFn:async()=>{var t,r;if(!e.promotionCode)return null;try{let r=await (0,y.A)(_,e),n=null==r||null==(t=r.cart)?void 0:t.savePromotion;return(null==n?void 0:n.cartId)&&(!n.invalidReason||!n.errorCode)&&(0,v.R2)(n.cartId),(0,v.Mg)(),n}catch(e){if((null==e||null==(r=e.response)?void 0:r.status)===404)return{cartId:null,resultCategory:"user_exception",errorCode:"not_found",invalidReason:"not_found"};return{cartId:null,resultCategory:"unexpected_error",errorCode:"unexpected_error",invalidReason:"unexpected_error"}}}}}async function w(e){let t=(0,p.SX)(),r=(0,v.S$)();return t.fetchQuery(E({cartId:r,promotionCode:e}))}var I=r(5383),A=r(76702);let P={cartSettings:null,cartSettingsError:null,cartSettingsLoading:!0,cartSettingsSuccess:!1,handleSetUrlDiscountCode:u(),maxAddOnQuantityReachedByBaseSku:{},maxChargerQuantityReached:!1,maxRingQuantityReached:!1,refreshCart:null,refreshCartError:null,refreshCartLoading:!0,refreshCartSuccess:!1,sitewideDiscounts:[],urlPromotionData:null,urlPromotionError:null,urlPromotionLoading:!0,urlPromotionSuccess:!1,urlDiscountCode:""},b=(0,i.createContext)(P),R=()=>(0,i.useContext)(b),x=e=>{var t;let{children:r}=e,[a,u]=(0,i.useState)([]),s=(0,d.useQuery)({queryKey:["GetCartSettings"],queryFn:async()=>{var e,t;let r=await (0,y.A)(f);return(null==r||null==(t=r.content)||null==(e=t.cartSettings)?void 0:e.contentsJson)?JSON.parse(r.content.cartSettings.contentsJson):{}}}),{value:c}=(0,o.useDynamicConfig)("sitewide_discount"),g=null!=(t=c.sitewideDiscount)?t:"";(0,i.useEffect)(()=>{(async()=>{try{let e=Array.isArray(g)?g.map(e=>w(e)):[w(g)],t=await Promise.all(e);u(t)}catch(e){(0,l.A)({error:e,message:"sitewide discount(s) failed to apply",module:"discount"})}})()},[g]);let[m,p]=(0,i.useState)(""),h=function(e){let t=(0,v.S$)();return(0,d.useQuery)({...E({cartId:t,promotionCode:e}),enabled:!!e&&!!t})}(m);m&&(0,I.Xx)(A.MM)!==m&&(0,I.RW)(A.MM,m);let _=function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0],r=(0,v.S$)();return(0,d.useQuery)({...{queryKey:["refreshCart",(e={cartId:r}).cartId],queryFn:async()=>{var t;let r=await (0,y.A)(S,e),n=null==r||null==(t=r.cart)?void 0:t.refreshCart;return(null==n?void 0:n.resultCategory)==="success"&&n.cartId&&(0,v.R2)(n.cartId),n}},enabled:!t,staleTime:(0,C.A)()?3e5:1/0})}(!a.length||h.isLoading),P=(0,i.useMemo)(()=>{var e;let t=null==(e=_.data)?void 0:e.cart,r=null==t?void 0:t.maxRingQuantity,n=null==t?void 0:t.ringCount;return"number"==typeof r&&"number"==typeof n&&r===n},[_]),R=(0,i.useMemo)(()=>{var e;let t=null==(e=_.data)?void 0:e.cart,r=null==t?void 0:t.maxChargerQuantity,n=null==t?void 0:t.chargerCount;return"number"==typeof r&&"number"==typeof n&&r===n},[_]),x=(0,i.useMemo)(()=>{var e,t,r,n,o,a;let u=null!=(o=null==(e=s.data)?void 0:e.maxAddOnQuantityByBaseSku)?o:{},i=null!=(a=null==(n=_.data)||null==(r=n.cart)||null==(t=r.lineItems)?void 0:t.filter(e=>!!e))?a:[];return i.reduce((e,t)=>{let r=t.skuCode;if(r){var n;let t=null!=(n=Object.keys(u).find(e=>r.startsWith(e)))?n:"",o=i.reduce((e,t)=>{var n;return r===t.skuCode?e+(null!=(n=t.quantity)?n:0):e},0),a=u[t];return{...e,[t]:a===o}}return e},{})},[s,_]),D=e=>{p(e)},N=(0,i.useMemo)(()=>({cartSettings:s.data,cartSettingsError:s.error,cartSettingsLoading:s.isLoading,cartSettingsSuccess:s.isSuccess,handleSetUrlDiscountCode:D,maxAddOnQuantityReachedByBaseSku:x,maxChargerQuantityReached:R,maxRingQuantityReached:P,refreshCart:_.data,refreshCartError:_.error,refreshCartLoading:_.isLoading,refreshCartSuccess:_.isSuccess,sitewideDiscounts:a,urlPromotionData:h.data,urlPromotionError:h.error,urlPromotionLoading:h.isLoading,urlPromotionSuccess:h.isSuccess,urlDiscountCode:m}),[s,x,R,P,_,a,h,m]);return(0,n.jsx)(b.Provider,{value:N,children:r})}}}]);
//# sourceMappingURL=6654-b358b0eb08f83de1.js.map